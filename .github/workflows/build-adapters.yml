name: Build All Adapters

on:
  # Run daily at 9:00 AM UTC
  schedule:
    - cron: '0 9 * * *'
  
  # Allow manual trigger from GitHub UI
  workflow_dispatch:
  
  # Also run on push to master for immediate feedback
  push:
    branches:
      - master
  
  # Run on pull requests
  pull_request:

jobs:
  build:
    name: Build Adapters
    runs-on: ubuntu-latest
    
    strategy:
      fail-fast: false
      matrix:
        adapter:
          - Applovin
          - BidMachine
          - Bigo
          - Chartboost
          - Facebook
          - Google (AdMob and Ad Manager)
          - InMobi
          - Line
          - MobileFuse
          - Moloco
          - Ogury
          - Pangle
          - PubMatic
          - UnityAds
          - Verve
          - Vungle
          - Yandex
          - YSO
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'gradle'
      
      - name: Grant execute permission for gradlew
        run: chmod +x "Adapters/${{ matrix.adapter }}/gradlew"
        
      - name: Build ${{ matrix.adapter }} adapter
        run: |
          cd "Adapters/${{ matrix.adapter }}"
          ./gradlew build --no-daemon --stacktrace
      
      - name: Upload build artifacts
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: build-reports-${{ matrix.adapter }}
          path: |
            Adapters/${{ matrix.adapter }}/**/build/reports/
            Adapters/${{ matrix.adapter }}/**/build/test-results/
          retention-days: 7

  notify:
    name: Build Summary
    runs-on: ubuntu-latest
    needs: build
    if: always()
    
    steps:
      - name: Check build status
        run: |
          if [ "${{ needs.build.result }}" == "success" ]; then
            echo "✅ All adapters built successfully!"
            exit 0
          else
            echo "❌ Some adapters failed to build"
            exit 1
          fi

